## What is Core Dump File
A program that crashes automatically produces a file , which is called core dump file . A core file or core dump is a file that records the memory image of a running process and its process status. Its primary use is post-mortem debugging of a program that crashed while it ran outside a debugger. 
## How to Use Core Dump with GDB
#### 1.Get a core dump
First, we must ensure that we can get a core file before we debug . As usually , kernel won't creat core dump file. we can use  `ulimit -c ` command to check its' state. This command shows the maximum size of core dumps created, and it show `0` means core dump is off. 
***
Use follow command to enable it.
```
$ulimit -c unlimited
``` 
And it's set to zero: disabling core dumps (for this process and its children). 
```
$ulimit -c 0
```
***
#### 2.Configure  Core Dump

Then we should define where core dump file to save. In general , `kernel.core_pattern` is a kernel parameter or a "sysctl setting" that decide where core dump file to save.  This configure file is saved in `/proc/sys/kernel/core_pattern` , use follow command to change it .
```
$sysctl -w kernel.core_pattern=/tmp/core_dump/core-%e.%p.%h.%t
```
Using above command will write core dumps to `/tmp/core_dump/core-<a bunch of stuff identifying the process>`. By default on Centos 7 ,core_pattern is set  in path `/proc/sys/kernel/core_pattern`  and stuff is 
```
kernel.core_pattern = |/usr/libexec/abrt-hook-ccpp %s %c %p %u %g %t e %P %I %h
```
*** 
#### 3.debug with core dump file
You can debug programm with core dump file like this :
```
$gdb path/to/the/programm/binary path/to/the/core
```
or you can also do this 
```
$gdb path/to/the/programm/binary -c path/to/the/core/file
```
In this way , you can find where your code crash or where is the segfault. And figure it out.
*** 
### Example of core dump file 
Here is an example code for your better understanding.
***
```
$cat test.c
#include <stdio.h>

void main()
{
	char *temp = "Paras";

	int i=0;

	temp[3]='F';

	for (i =0 ; i < 5 ; i++ )
		printf("%c\n", temp[i]);

	
}
```
***
Then we compile it and run it.
```
$ gcc test.c -o test -g
$ ./test
Segmentation fault (core dumped)
```
There is a segmentation fault show in command line. Then we debug this program with core dump file.
```
$gdb test -c /tmp/core-test.16270

GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-115.el7
Copyright (C) 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-redhat-linux-gnu".
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>...
Reading symbols from /home/jiangdi/Tools_Efficient/Note_GDB/gdb_core/test...done.

warning: exec file is newer than core file.
[New LWP 16270]
Core was generated by `./test'.
Program terminated with signal 11, Segmentation fault.
#0  0x000000000040054c in main () at test.c:9
9		temp[3]='F';
Missing separate debuginfos, use: debuginfo-install glibc-2.17-292.el7.x86_64
```
we can see programm was interupt in the line 9 of test.c.Then we should figure it out.  
we enter `run`command.
```
(gdb) run
Starting program: /home/jiangdi/Tools_Efficient/Note_GDB/gdb_core/test 

Program received signal SIGSEGV, Segmentation fault.
0x000000000040054c in main () at test.c:9
9		temp[3]='F';
```
then we check the code, `char *temp = "Paras"` .`temp` , which points to a random address where the nameless array with the value `Paras` resides, is pointing to a constant (sometimes called a string literal.) . Attempting to modify a string literal is undefined. Therefore the ` line  9` with the error is trying to change the third character of this constant.

***
* [How to get a core dump for a segfault on Linux](https://jvns.ca/blog/2018/04/28/debugging-a-segfault-on-linux/)
* [How to Produce a Core File from Your Program](https://sourceware.org/gdb/download/onlinedocs/gdb/Core-File-Generation.html#Core-File-Generation)
* [gdb Debugging Full Example (Tutorial): ncurses](http://www.brendangregg.com/blog/2016-08-09/gdb-example-ncurses.html)
* [Core dump file analysis](https://stackoverflow.com/questions/5115613/core-dump-file-analysis)
* [Why the following will produce segmentation fault?](https://stackoverflow.com/questions/4231024/why-the-following-will-produce-segmentation-fault)
